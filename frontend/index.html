<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Testing Agent</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div class="main-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div>
            <h1>ğŸ¤– Web Testing Agent</h1>
            <p class="subtitle">AI-powered test exploration and design</p>
          </div>
          <button onclick="resetAgent()" class="btn-danger" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">ğŸ”„ Reset Agent</button>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
          <button class="tab-btn active" onclick="switchTab('explorations')">
            ğŸ“ Explorations
          </button>
          <button
            class="tab-btn"
            onclick="switchTab('testsuites')"
            id="testSuitesTab"
          >
            ğŸ“‹ Test Suites
          </button>
          <button class="tab-btn" onclick="switchTab('review')" id="reviewTab">
            ğŸ’¬ Review & Edit
          </button>
          <button
            class="tab-btn"
            onclick="switchTab('codegen')"
            id="codegenTab"
          >
            ğŸ’» Generate Code
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="tab-explorations">
          <!-- Exploration Input Section -->
          <div class="input-section" style="margin-bottom: 15px; flex-shrink: 0;">
            <input
              type="text"
              id="urlInput"
              placeholder="Enter URL to explore (e.g., https://demo.playwright.dev/todomvc)"
              value="https://www.google.com"
              onkeypress="if(event.key === 'Enter') exploreUrl()"
            />
            <button onclick="exploreUrl()" id="exploreBtn">ğŸ” Explore</button>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 250px 1fr;
              gap: 15px;
              flex: 1;
              min-height: 0;
              overflow: hidden;
            "
          >
            <!-- Saved Explorations Sidebar -->
            <div
              style="
                border-right: 1px solid #e0e0e0;
                padding-right: 15px;
                display: flex;
                flex-direction: column;
                min-height: 0;
                max-height: 70%;
                overflow: hidden;
              "
            >
              <h4
                style="
                  margin-bottom: 10px;
                  color: #333;
                  font-size: 13px;
                  font-weight: 600;
                  flex-shrink: 0;
                "
              >
                ğŸ“ Saved Sessions
              </h4>
              <div
                id="explorationsList"
                style="
                  overflow-y: auto;
                  overflow-x: hidden;
                  flex: 1;
                  min-height: 0;
                "
              >
                <div
                  style="
                    color: #999;
                    font-size: 11px;
                    text-align: center;
                    padding: 20px 10px;
                  "
                >
                  No explorations yet
                </div>
              </div>
            </div>

            <!-- Exploration Display Area -->
            <div
              id="explorationDisplay"
              style="
                overflow-y: auto;
                padding: 0 10px;
                min-height: 0;
              "
            >
              <div
                style="color: #6c757d; text-align: center; padding: 60px 20px"
              >
                <div style="font-size: 48px; margin-bottom: 20px">ğŸ”</div>
                <div
                  style="font-size: 18px; font-weight: 600; margin-bottom: 10px"
                >
                  Select or Create
                </div>
                <div style="font-size: 14px">
                  Click an exploration or create a new one above
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-testsuites" style="display: none">
          <!-- Test Design Controls -->
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
            <label style="font-size: 13px; color: #667eea; font-weight: 600;">Test Count:</label>
            <select
              id="testCountSelect"
              style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e0e0e0; font-size: 13px;"
            >
              <option value="5">5 tests</option>
              <option value="8">8 tests</option>
              <option value="10">10 tests</option>
              <option value="12" selected>12 tests</option>
              <option value="15">15 tests</option>
              <option value="20">20 tests</option>
            </select>
            <button onclick="designTests()" id="designBtn" disabled style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 600;">ğŸ“‹ Design Tests</button>
            <div style="flex: 1;"></div>
            <span style="font-size: 12px; color: #6c757d;">ğŸ’¡ Select an exploration from the Explorations tab first</span>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 250px 1fr;
              gap: 15px;
              flex: 1;
              min-height: 0;
              overflow: hidden;
            "
          >
            <!-- Test Suites Sidebar -->
            <div
              style="
                border-right: 1px solid #e0e0e0;
                padding-right: 15px;
                display: flex;
                flex-direction: column;
                min-height: 0;
                max-height: 70%;
                overflow: hidden;
              "
            >
              <h4
                style="
                  margin-bottom: 10px;
                  color: #333;
                  font-size: 13px;
                  font-weight: 600;
                  flex-shrink: 0;
                "
              >
                ğŸ“‹ Saved Suites
              </h4>
              <div
                id="testSuitesList"
                style="
                  overflow-y: auto;
                  overflow-x: hidden;
                  flex: 1;
                  min-height: 0;
                "
              >
                <div
                  style="
                    color: #999;
                    font-size: 11px;
                    text-align: center;
                    padding: 20px 10px;
                  "
                >
                  No test suites yet
                </div>
              </div>
            </div>

            <!-- Test Suite Display Area -->
            <div
              id="testSuiteDisplay"
              style="
                overflow-y: auto;
                padding: 0 10px;
                min-height: 0;
              "
            >
              <div
                style="color: #6c757d; text-align: center; padding: 60px 20px"
              >
                <div style="font-size: 48px; margin-bottom: 20px">ğŸ“‹</div>
                <div
                  style="font-size: 18px; font-weight: 600; margin-bottom: 10px"
                >
                  No Suite Selected
                </div>
                <div style="font-size: 14px">
                  Generate test cases from an exploration or select a saved
                  suite
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-review" style="display: none">
          <div style="height: 100%; display: flex; flex-direction: column">
            <!-- Suite Selector -->
            <div
              style="
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 15px;
                flex-shrink: 0;
              "
            >
              <div style="margin-bottom: 10px">
                <label
                  style="
                    font-size: 13px;
                    color: #667eea;
                    font-weight: 600;
                    margin-right: 10px;
                  "
                  >Select Suite:</label
                >
                <select
                  id="reviewSuiteSelect"
                  onchange="loadSuiteForReview()"
                  style="
                    padding: 8px 12px;
                    border-radius: 6px;
                    border: 1px solid #e0e0e0;
                    font-size: 13px;
                    min-width: 200px;
                  "
                >
                  <option value="">-- Select a test suite --</option>
                </select>
              </div>
              <div style="display: flex; align-items: center; gap: 10px">
                <div
                  style="
                    background: white;
                    border-radius: 6px;
                    padding: 3px;
                    display: inline-flex;
                    border: 1px solid #e0e0e0;
                  "
                >
                  <button
                    onclick="switchReviewMode('edit')"
                    id="editModeBtn"
                    class="review-mode-btn active"
                    style="
                      padding: 6px 16px;
                      background: #667eea;
                      color: white;
                      border: none;
                      border-radius: 4px;
                      font-size: 12px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    âœï¸ Manual Edit
                  </button>
                  <button
                    onclick="switchReviewMode('chat')"
                    id="chatModeBtn"
                    class="review-mode-btn"
                    style="
                      padding: 6px 16px;
                      background: transparent;
                      color: #667eea;
                      border: none;
                      border-radius: 4px;
                      font-size: 12px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    ğŸ’¬ AI Chat
                  </button>
                </div>
                <button
                  onclick="addNewTest()"
                  id="addTestBtn"
                  disabled
                  style="
                    padding: 8px 16px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 13px;
                    cursor: pointer;
                  "
                >
                  â• Add Test
                </button>
                <button
                  onclick="saveSuiteChanges()"
                  id="saveSuiteBtn"
                  disabled
                  style="
                    padding: 8px 16px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 13px;
                    cursor: pointer;
                  "
                >
                  ğŸ’¾ Save Changes
                </button>
              </div>
            </div>

            <!-- Manual Edit Panel -->
            <div
              id="reviewEditPanel"
              style="flex: 1; overflow-y: auto; min-height: 0; display: block"
            >
              <div id="reviewTestsContainer">
                <div
                  style="color: #6c757d; text-align: center; padding: 60px 20px"
                >
                  <div style="font-size: 48px; margin-bottom: 20px">âœï¸</div>
                  <div
                    style="
                      font-size: 18px;
                      font-weight: 600;
                      margin-bottom: 10px;
                    "
                  >
                    Manual Edit Mode
                  </div>
                  <div style="font-size: 14px">
                    Select a test suite above to edit test cases directly
                  </div>
                </div>
              </div>
            </div>

            <!-- AI Chat Panel -->
            <div
              id="reviewChatPanel"
              style="
                flex: 1;
                display: none;
                flex-direction: column;
                min-height: 0;
              "
            >
              <div
                id="chatMessages"
                style="
                  flex: 1;
                  overflow-y: auto;
                  background: white;
                  border: 1px solid #e0e0e0;
                  border-radius: 8px;
                  padding: 15px;
                  margin-bottom: 10px;
                "
              >
                <div
                  style="color: #6c757d; text-align: center; padding: 40px 20px"
                >
                  <div style="font-size: 48px; margin-bottom: 20px">ğŸ’¬</div>
                  <div
                    style="
                      font-size: 18px;
                      font-weight: 600;
                      margin-bottom: 10px;
                    "
                  >
                    AI Chat Mode
                  </div>
                  <div style="font-size: 14px">
                    Ask me to add, modify, or remove tests
                  </div>
                </div>
              </div>
              <div style="display: flex; gap: 8px; flex-shrink: 0">
                <input
                  type="text"
                  id="chatInput"
                  placeholder="Ask me to modify tests (e.g., 'Add a test for login validation')"
                  style="
                    flex: 1;
                    padding: 10px 15px;
                    border: 1px solid #e0e0e0;
                    border-radius: 6px;
                    font-size: 13px;
                  "
                  onkeypress="if(event.key==='Enter') sendChatMessage()"
                />
                <button
                  onclick="sendChatMessage()"
                  id="sendChatBtn"
                  disabled
                  style="
                    padding: 10px 20px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 13px;
                    cursor: pointer;
                    font-weight: 600;
                  "
                >
                  Send
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-codegen" style="display: none">
          <div style="height: 100%; display: flex; flex-direction: column">
            <div
              style="
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 15px;
                flex-shrink: 0;
              "
            >
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 10px;
                  margin-bottom: 12px;
                "
              >
                <label style="font-size: 13px; color: #667eea; font-weight: 600"
                  >Select Suite:</label
                >
                <select
                  id="codegenSuiteSelect"
                  onchange="updateCodegenPreview()"
                  style="
                    padding: 8px 12px;
                    border-radius: 6px;
                    border: 1px solid #e0e0e0;
                    font-size: 13px;
                    min-width: 200px;
                  "
                >
                  <option value="">-- Select a test suite --</option>
                </select>
                <button
                  onclick="generateCode()"
                  id="generateCodeBtn"
                  disabled
                  style="
                    padding: 8px 20px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 13px;
                    cursor: pointer;
                    font-weight: 600;
                  "
                >
                  âš¡ Generate Playwright Code
                </button>
                <button
                  onclick="downloadCode()"
                  id="downloadCodeBtn"
                  disabled
                  style="
                    padding: 8px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 13px;
                    cursor: pointer;
                    font-weight: 600;
                  "
                >
                  â¬‡ï¸ Download
                </button>
              </div>
              <div style="display: flex; align-items: flex-start; gap: 10px">
                <label
                  style="
                    font-size: 13px;
                    color: #667eea;
                    font-weight: 600;
                    padding-top: 8px;
                  "
                  >Custom Instructions:</label
                >
                <textarea
                  id="codegenInstructions"
                  placeholder="Add custom instructions for code generation (e.g., 'Use data-testid attributes for locators', 'Add extra assertions for accessibility', 'Include retry logic for flaky elements')"
                  style="
                    flex: 1;
                    padding: 10px 12px;
                    border-radius: 6px;
                    border: 1px solid #e0e0e0;
                    font-size: 13px;
                    min-height: 60px;
                    resize: vertical;
                    font-family: inherit;
                  "
                ></textarea>
              </div>
            </div>

            <div
              id="codegenDisplay"
              style="
                flex: 1;
                overflow-y: auto;
                background: #1e1e1e;
                border-radius: 8px;
                padding: 20px;
                min-height: 0;
              "
            >
              <div
                style="color: #a0a0a0; text-align: center; padding: 60px 20px"
              >
                <div style="font-size: 48px; margin-bottom: 20px">ğŸ’»</div>
                <div
                  style="
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 10px;
                    color: #ffffff;
                  "
                >
                  Code Generation
                </div>
                <div style="font-size: 14px">
                  Select a test suite to generate Playwright Python code
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="metrics-panel">
        <h3 style="margin-bottom: 20px; color: #333">ğŸ“Š Metrics</h3>

        <div class="metric-card">
          <div class="metric-label">Total Response Time</div>
          <div class="metric-value" id="totalTime">
            0<span class="metric-unit">s</span>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Tokens Used</div>
          <div class="metric-value" id="totalTokens">
            0<span class="metric-unit">tokens</span>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Avg Response Time</div>
          <div class="metric-value" id="avgTime">
            0<span class="metric-unit">s</span>
          </div>
        </div>

        <div id="phaseMetrics"></div>
      </div>
    </div>

    <!-- Core modules - load first -->
    <script src="js/state.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/metrics.js"></script>
    
    <!-- UI modules - load after core -->
    <script src="js/ui/explore.js"></script>
    <script src="js/ui/design.js"></script>
    <script src="js/ui/review.js"></script>
    <script src="js/ui/codegen.js"></script>
    
    <!-- Main app - load last -->
    <script src="js/main.js"></script>
  </body>
</html>
